<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AkademiTrack.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="500"
        x:Class="AkademiTrack.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/AT-Transparrent.png"
        Title="AkademiTrack - Akademiet Drammen Sundland"
        Background="#F8F9FA"
		Height="500"
		Width="700"
        MinWidth="600"
        MinHeight="400">

	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>

	<Window.Resources>
		<!-- String Equality Converter -->
		<vm:StringEqualityConverter x:Key="StringEqualityConverter"/>
	</Window.Resources>

	<Window.Styles>
		<!-- Force all buttons to always be visible -->
		<Style Selector="Button">
			<Setter Property="IsVisible" Value="True"/>
			<Setter Property="Focusable" Value="True"/>
		</Style>

		<Style Selector="Button:disabled">
			<Setter Property="IsVisible" Value="True"/>
		</Style>

		<!-- Remove focus outlines globally -->
		<Style Selector="Button:focus /template/ Border">
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
		</Style>

		<Style Selector="Button:focus-visible /template/ Border">
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
		</Style>

		<!-- Start Button Styles -->
		<Style Selector="Button.start-button">
			<Setter Property="Background" Value="#007ACC"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="CornerRadius" Value="6"/>
			<Setter Property="Padding" Value="18,10"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="MinWidth" Value="140"/>
			<Setter Property="IsVisible" Value="True"/>
			<Setter Property="Template">
				<ControlTemplate>
					<Border Name="PART_Border"
							Background="{TemplateBinding Background}"
							CornerRadius="{TemplateBinding CornerRadius}"
							Padding="{TemplateBinding Padding}"
							BorderThickness="0"
							BorderBrush="Transparent">
						<ContentPresenter Name="PART_ContentPresenter"
										Content="{TemplateBinding Content}"
										HorizontalAlignment="Center"
										VerticalAlignment="Center"
										TextBlock.Foreground="{TemplateBinding Foreground}"
										TextBlock.FontWeight="{TemplateBinding FontWeight}"
										TextBlock.FontSize="{TemplateBinding FontSize}"
										TextBlock.TextAlignment="Center"/>
					</Border>
				</ControlTemplate>
			</Setter>
		</Style>

		<Style Selector="Button.start-button:pointerover /template/ Border#PART_Border">
			<Setter Property="Background" Value="#005A9E"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.start-button:focus /template/ Border#PART_Border">
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.start-button:disabled /template/ Border#PART_Border">
			<Setter Property="Background" Value="#CCCCCC"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.start-button:disabled /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="TextBlock.Foreground" Value="#888888"/>
		</Style>

		<!-- Stop Button Styles -->
		<Style Selector="Button.stop-button">
			<Setter Property="Background" Value="#DC3545"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="CornerRadius" Value="6"/>
			<Setter Property="Padding" Value="18,10"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="MinWidth" Value="140"/>
			<Setter Property="IsVisible" Value="True"/>
			<Setter Property="Template">
				<ControlTemplate>
					<Border Name="PART_Border"
							Background="{TemplateBinding Background}"
							CornerRadius="{TemplateBinding CornerRadius}"
							Padding="{TemplateBinding Padding}"
							BorderThickness="0"
							BorderBrush="Transparent">
						<ContentPresenter Name="PART_ContentPresenter"
										Content="{TemplateBinding Content}"
										HorizontalAlignment="Center"
										VerticalAlignment="Center"
										TextBlock.Foreground="{TemplateBinding Foreground}"
										TextBlock.FontWeight="{TemplateBinding FontWeight}"
										TextBlock.FontSize="{TemplateBinding FontSize}"
										TextBlock.TextAlignment="Center"/>
					</Border>
				</ControlTemplate>
			</Setter>
		</Style>

		<Style Selector="Button.stop-button:pointerover /template/ Border#PART_Border">
			<Setter Property="Background" Value="#B02A37"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.stop-button:focus /template/ Border#PART_Border">
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.stop-button:disabled /template/ Border#PART_Border">
			<Setter Property="Background" Value="#CCCCCC"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.stop-button:disabled /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="TextBlock.Foreground" Value="#888888"/>
		</Style>

		<Style Selector="Button.settings">
			<Setter Property="Background" Value="#6C757D"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="Medium"/>
			<Setter Property="CornerRadius" Value="6"/>
			<Setter Property="Padding" Value="14,8"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="FontSize" Value="12"/>
			<Setter Property="MinWidth" Value="180"/>
			<Setter Property="Template">
				<ControlTemplate>
					<Border Name="PART_Border"
							Background="{TemplateBinding Background}"
							CornerRadius="{TemplateBinding CornerRadius}"
							Padding="{TemplateBinding Padding}"
							BorderThickness="0"
							BorderBrush="Transparent">
						<ContentPresenter Name="PART_ContentPresenter"
										Content="{TemplateBinding Content}"
										HorizontalAlignment="Center"
										VerticalAlignment="Center"
										TextBlock.Foreground="{TemplateBinding Foreground}"
										TextBlock.FontWeight="{TemplateBinding FontWeight}"
										TextBlock.FontSize="{TemplateBinding FontSize}"
										TextBlock.TextAlignment="Center"/>
					</Border>
				</ControlTemplate>
			</Setter>
		</Style>

		<Style Selector="Button.settings:pointerover /template/ Border#PART_Border">
			<Setter Property="Background" Value="#545B62"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.settings:focus /template/ Border#PART_Border">
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="TextBlock.title">
			<Setter Property="FontSize" Value="28"/>
			<Setter Property="FontWeight" Value="Light"/>
			<Setter Property="Foreground" Value="#212529"/>
			<Setter Property="Margin" Value="0,0,0,6"/>
		</Style>

		<Style Selector="TextBlock.subtitle">
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="FontWeight" Value="Normal"/>
			<Setter Property="Foreground" Value="#6C757D"/>
			<Setter Property="Margin" Value="0,0,0,20"/>
		</Style>

		<Style Selector="TextBlock.info">
			<Setter Property="FontSize" Value="12"/>
			<Setter Property="FontWeight" Value="Normal"/>
			<Setter Property="Foreground" Value="#6C757D"/>
			<Setter Property="Margin" Value="0,0,0,16"/>
			<Setter Property="TextAlignment" Value="Center"/>
		</Style>

		<Style Selector="TextBlock.status">
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="FontWeight" Value="Medium"/>
			<Setter Property="Foreground" Value="#495057"/>
			<Setter Property="TextAlignment" Value="Center"/>
			<Setter Property="Margin" Value="0,0,0,0"/>
		</Style>

		<Style Selector="TextBlock.status-label">
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="FontSize" Value="11"/>
			<Setter Property="Foreground" Value="#6C757D"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
		</Style>

		<!-- Notification Styles -->
		<Style Selector="Border.notification">
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="Padding" Value="16,12"/>
			<Setter Property="Margin" Value="16"/>
			<Setter Property="BoxShadow" Value="0 4 12 0 #00000020"/>
			<Setter Property="MinWidth" Value="300"/>
			<Setter Property="MaxWidth" Value="400"/>
		</Style>

		<Style Selector="Border.notification.info">
			<Setter Property="Background" Value="#D1ECF1"/>
			<Setter Property="BorderBrush" Value="#BEE5EB"/>
			<Setter Property="BorderThickness" Value="1"/>
		</Style>

		<Style Selector="Border.notification.success">
			<Setter Property="Background" Value="#D4EDDA"/>
			<Setter Property="BorderBrush" Value="#C3E6CB"/>
			<Setter Property="BorderThickness" Value="1"/>
		</Style>

		<Style Selector="Border.notification.warning">
			<Setter Property="Background" Value="#FFF3CD"/>
			<Setter Property="BorderBrush" Value="#FFEAA7"/>
			<Setter Property="BorderThickness" Value="1"/>
		</Style>

		<Style Selector="Border.notification.error">
			<Setter Property="Background" Value="#F8D7DA"/>
			<Setter Property="BorderBrush" Value="#F5C6CB"/>
			<Setter Property="BorderThickness" Value="1"/>
		</Style>

		<Style Selector="TextBlock.notification-title">
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="Margin" Value="0,0,0,4"/>
		</Style>

		<Style Selector="TextBlock.notification-title.info">
			<Setter Property="Foreground" Value="#0C5460"/>
		</Style>

		<Style Selector="TextBlock.notification-title.success">
			<Setter Property="Foreground" Value="#155724"/>
		</Style>

		<Style Selector="TextBlock.notification-title.warning">
			<Setter Property="Foreground" Value="#856404"/>
		</Style>

		<Style Selector="TextBlock.notification-title.error">
			<Setter Property="Foreground" Value="#721C24"/>
		</Style>

		<Style Selector="TextBlock.notification-message">
			<Setter Property="FontSize" Value="12"/>
			<Setter Property="TextWrapping" Value="Wrap"/>
		</Style>

		<Style Selector="TextBlock.notification-message.info">
			<Setter Property="Foreground" Value="#0C5460"/>
		</Style>

		<Style Selector="TextBlock.notification-message.success">
			<Setter Property="Foreground" Value="#155724"/>
		</Style>

		<Style Selector="TextBlock.notification-message.warning">
			<Setter Property="Foreground" Value="#856404"/>
		</Style>

		<Style Selector="TextBlock.notification-message.error">
			<Setter Property="Foreground" Value="#721C24"/>
		</Style>

		<Style Selector="Button.notification-close">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Padding" Value="4"/>
			<Setter Property="FontSize" Value="16"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Width" Value="24"/>
			<Setter Property="Height" Value="24"/>
		</Style>
	</Window.Styles>

	<Grid>
		<!-- Main Content -->
		<Grid Margin="30,25">
			<StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="20">

				<!-- App Title -->
				<TextBlock Text="AkademiTrack"
	                      Classes="title"
	                      HorizontalAlignment="Center"/>

				<TextBlock Text="Automatisk Oppmøte-system - Akademiet Drammen Sundland"
	                      Classes="subtitle"
	                      HorizontalAlignment="Center"/>

				<!-- Info Text -->
				<TextBlock Text="Klikk Start for å begynne automatisk overvåking av oppmøte.&#x0a;Systemet håndterer innlogging og cookie-behandling automatisk."
	                      Classes="info"
	                      HorizontalAlignment="Center"
	                      TextWrapping="Wrap"
	                      MaxWidth="450"/>

				<!-- Main Control Buttons -->
				<StackPanel Orientation="Horizontal"
	                       HorizontalAlignment="Center"
	                       Spacing="12">

					<!-- Start button -->
					<Button Content="Start Automatisering"
	                       Classes="start-button"
	                       Command="{Binding StartAutomationCommand}"
	                       IsEnabled="{Binding !IsAutomationRunning}"
	                       ToolTip.Tip="Starter automatisering med automatisk innlogging og cookie-behandling"/>

					<!-- Stop button -->
					<Button Content="Stopp Automatisering"
	                       Classes="stop-button"
	                       Command="{Binding StopAutomationCommand}"
	                       IsEnabled="{Binding IsAutomationRunning}"
	                       ToolTip.Tip="Stopper automatiseringsprosessen"/>

					<Button Content="Test Supabase Connection"
							Classes="settings"
							Command="{Binding TestSupabaseCommand}"
							ToolTip.Tip="Test sending STU registration data to Supabase database"/>
				</StackPanel>
				
				

				<!-- Settings Button -->
				<StackPanel HorizontalAlignment="Center">
					<Button Content="Innstillinger og Aktivitetslogg"
	                       Classes="settings"
	                       Command="{Binding OpenSettingsCommand}"
	                       ToolTip.Tip="Åpne innstillinger og vis aktivitetslogger"/>
				</StackPanel>

				<!-- Current Status Display -->
				<Border Background="White"
	                   CornerRadius="6"
	                   Padding="16,12"
	                   BorderThickness="1"
	                   BorderBrush="#E9ECEF"
	                   MaxWidth="420"
	                   MinWidth="300">

					<StackPanel Spacing="6">
						<TextBlock Text="Gjeldende Status:"
	                              Classes="status-label"/>

						<TextBlock Text="{Binding StatusMessage}"
	                              Classes="status"
	                              HorizontalAlignment="Center"
	                              TextWrapping="Wrap"
	                              MaxWidth="380"/>
					</StackPanel>
				</Border>

			</StackPanel>
		</Grid>

		<!-- Notification Popup (Top-Right Corner) -->
		<Border IsVisible="{Binding HasCurrentNotification}"
		        HorizontalAlignment="Right"
		        VerticalAlignment="Top"
		        Classes="notification"
		        Classes.info="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=INFO}"
		        Classes.success="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=SUCCESS}"
		        Classes.warning="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=WARNING}"
		        Classes.error="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=ERROR}">

			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>

				<StackPanel Grid.Column="0" Spacing="4">
					<TextBlock Text="{Binding CurrentNotification.Title}"
					           Classes="notification-title"
					           Classes.info="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=INFO}"
					           Classes.success="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=SUCCESS}"
					           Classes.warning="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=WARNING}"
					           Classes.error="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=ERROR}"/>

					<TextBlock Text="{Binding CurrentNotification.Message}"
					           Classes="notification-message"
					           Classes.info="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=INFO}"
					           Classes.success="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=SUCCESS}"
					           Classes.warning="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=WARNING}"
					           Classes.error="{Binding CurrentNotification.Level, Converter={StaticResource StringEqualityConverter}, ConverterParameter=ERROR}"/>
				</StackPanel>

				<Button Grid.Column="1"
				        Content="×"
				        Classes="notification-close"
				        Command="{Binding DismissNotificationCommand}"
				        VerticalAlignment="Top"
				        HorizontalAlignment="Right"/>
			</Grid>
		</Border>
	</Grid>
</Window>