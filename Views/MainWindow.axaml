<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AkademiTrack.ViewModels"
        xmlns:views="using:AkademiTrack.Views"
        xmlns:services="using:AkademiTrack.Services"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
        mc:Ignorable="d" d:DesignWidth="1100" d:DesignHeight="750"
        x:Class="AkademiTrack.Views.MainWindow"
        x:DataType="vm:RefactoredMainWindowViewModel"
        Icon="/Assets/AT-Transparrent.png"
        Title="AkademiTrack - Akademiet"
        Background="{Binding Source={x:Static services:ThemeManager.Instance}, Path=WindowBackground, Mode=OneWay}"
		Height="705"
		Width="1100"
        MinWidth="900"
        MinHeight="705">

	<Design.DataContext>
		<vm:RefactoredMainWindowViewModel/>
	</Design.DataContext>

	<Window.Resources>
		<vm:StringEqualityConverter x:Key="StringEqualityConverter"/>
		<vm:ColorNameToBrushConverter x:Key="ColorNameToBrushConverter"/>
		<vm:PercentageToWidthConverter x:Key="PercentageToWidthConverter"/>
		<vm:PercentageToHeightConverter x:Key="PercentageToHeightConverter"/>
		<vm:DayOfWeekConverter x:Key="DayOfWeekConverter"/>
		<vm:TextLengthToFontSizeConverter x:Key="TextLengthToFontSizeConverter"/>
	</Window.Resources>

	<Window.Styles>
    <Style Selector="Button.theme-toggle">
        <Setter Property="Background" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=CardBackground}"/>
        <Setter Property="BorderBrush" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=CardBorder}"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="CornerRadius" Value="22.5"/>
        <Setter Property="HorizontalContentAlignment" Value="Center"/>
        <Setter Property="VerticalContentAlignment" Value="Center"/>
        <Setter Property="Padding" Value="0"/>
        <Setter Property="Foreground" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"/>
        <Setter Property="Template">
            <ControlTemplate>
                <Border Name="PART_Border"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="{TemplateBinding CornerRadius}"
                        Width="{TemplateBinding Width}"
                        Height="{TemplateBinding Height}">
                    <Grid>
                        <Border Name="PART_HoverOverlay"
                                CornerRadius="{TemplateBinding CornerRadius}"
                                Background="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"
                                Opacity="0">
                            <Border.Transitions>
                                <Transitions>
                                    <DoubleTransition Property="Opacity" Duration="0:0:0.15"/>
                                </Transitions>
                            </Border.Transitions>
                        </Border>
                        <ContentPresenter Content="{TemplateBinding Content}"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                    </Grid>
                </Border>
            </ControlTemplate>
        </Setter>
    </Style>

		<Style Selector="Button.theme-toggle:pointerover /template/ Border#PART_HoverOverlay">
			<Setter Property="Opacity" Value="0.12"/>
		</Style>

		<Style Selector="Button.theme-toggle:pressed /template/ Border#PART_HoverOverlay">
			<Setter Property="Opacity" Value="0.20"/>
		</Style>

		<!-- Dashboard Card Style -->
		<Style Selector="Border.dashboard-card">
			<Setter Property="Background" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=CardBackground}"/>
			<Setter Property="BorderBrush" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=CardBorder}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="CornerRadius" Value="12"/>
			<Setter Property="Padding" Value="20"/>
		</Style>

		<!-- Loading Overlay Styles -->
		<Style Selector="Border.loading-overlay">
			<Setter Property="Background" Value="#99000000"/>
			<Setter Property="ZIndex" Value="9999"/>
		</Style>

		<Style Selector="Border.loading-container">
			<Setter Property="Background" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=CardBackground}"/>
			<Setter Property="CornerRadius" Value="16"/>
			<Setter Property="Padding" Value="40"/>
			<Setter Property="BoxShadow" Value="0 8 32 0 #40000000"/>
		</Style>

		<Style Selector="Ellipse.loading-dot">
			<Setter Property="Width" Value="12"/>
			<Setter Property="Height" Value="12"/>
			<Setter Property="Fill" Value="#5B9BFF"/>
		</Style>

		<!-- Start Button -->
		<Style Selector="Button.start-button">
			<Setter Property="Background" Value="#5B9BFF"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="Padding" Value="20,12"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<ControlTemplate>
					<Border Background="{TemplateBinding Background}"
							BorderBrush="{TemplateBinding BorderBrush}"
							BorderThickness="{TemplateBinding BorderThickness}"
							CornerRadius="{TemplateBinding CornerRadius}"
							Padding="{TemplateBinding Padding}">
						<ContentPresenter Content="{TemplateBinding Content}"
										  Foreground="{TemplateBinding Foreground}"
										  HorizontalContentAlignment="Center"
										  VerticalContentAlignment="Center"/>
					</Border>
				</ControlTemplate>
			</Setter>
		</Style>

		<Style Selector="Button.start-button:pointerover">
			<Setter Property="Background" Value="#4080E8"/>
		</Style>

		<Style Selector="Button.start-button:disabled">
			<Setter Property="Background" Value="#CCCCCC"/>
			<Setter Property="Foreground" Value="#888888"/>
		</Style>

		<!-- Stop Button -->
		<Style Selector="Button.stop-button">
			<Setter Property="Background" Value="#6C757D"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="Medium"/>
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="Padding" Value="20,12"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<ControlTemplate>
					<Border Background="{TemplateBinding Background}"
							BorderBrush="{TemplateBinding BorderBrush}"
							BorderThickness="{TemplateBinding BorderThickness}"
							CornerRadius="{TemplateBinding CornerRadius}"
							Padding="{TemplateBinding Padding}">
						<ContentPresenter Content="{TemplateBinding Content}"
										  Foreground="{TemplateBinding Foreground}"
										  HorizontalContentAlignment="Center"
										  VerticalContentAlignment="Center"/>
					</Border>
				</ControlTemplate>
			</Setter>
		</Style>

		<Style Selector="Button.stop-button:pointerover">
			<Setter Property="Background" Value="#545B62"/>
		</Style>

		<Style Selector="Button.stop-button:disabled">
			<Setter Property="Background" Value="#CCCCCC"/>
			<Setter Property="Foreground" Value="#888888"/>
		</Style>

		<!-- Title Styles -->
		<Style Selector="TextBlock.main-title">
			<Setter Property="FontSize" Value="32"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Foreground" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"/>
		</Style>

		<Style Selector="TextBlock.subtitle">
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="FontWeight" Value="Normal"/>
			<Setter Property="Foreground" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextSecondary}"/>
		</Style>

		<Style Selector="TextBlock.card-label">
			<Setter Property="FontSize" Value="11"/>
			<Setter Property="FontWeight" Value="Medium"/>
			<Setter Property="Foreground" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextSecondary}"/>
			<Setter Property="Margin" Value="0,0,0,8"/>
		</Style>

		<Style Selector="TextBlock.card-value">
			<Setter Property="FontSize" Value="48"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Foreground" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"/>
		</Style>

		<Style Selector="TextBlock.card-value.green">
			<Setter Property="Foreground" Value="#4CAF50"/>
		</Style>

		<Style Selector="TextBlock.card-value.blue">
			<Setter Property="Foreground" Value="#5B9BFF"/>
		</Style>

		<Style Selector="TextBlock.card-value.orange">
			<Setter Property="Foreground" Value="#FF9800"/>
		</Style>

		<Style Selector="TextBlock.card-subtext">
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="Foreground" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextSecondary}"/>
			<Setter Property="Margin" Value="0,4,0,0"/>
		</Style>

		<Style Selector="TextBlock.section-title">
			<Setter Property="FontSize" Value="20"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"/>
			<Setter Property="Margin" Value="0,0,0,12"/>
		</Style>

		<!-- Status Box Styles -->
		<Style Selector="TextBlock.status-label">
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="FontSize" Value="11"/>
			<Setter Property="Foreground" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextSecondary}"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
		</Style>

		<Style Selector="TextBlock.status">
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="FontWeight" Value="Medium"/>
			<Setter Property="Foreground" Value="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"/>
			<Setter Property="TextAlignment" Value="Center"/>
			<Setter Property="Margin" Value="0,0,0,0"/>
		</Style>

	</Window.Styles>

	<!-- Main Grid that switches between Dashboard and Tutorial -->
	<Grid>
		<!-- Dashboard Content -->
		<Grid IsVisible="{Binding ShowDashboard}">
			<Grid Margin="30,20,30,20" MinWidth="840">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<!-- Header -->
				<Grid Grid.Row="0" Margin="0,0,0,20">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

				<!-- Title Section -->
				<StackPanel Grid.Column="0" VerticalAlignment="Center">
					<TextBlock Text="AkademiTrack" Classes="main-title"/>
					<TextBlock Text="Automatisk oppmÃ¸te-system - Akademiet" Classes="subtitle" Margin="0,4,0,0"/>
				</StackPanel>

				<!-- Action Buttons -->
				<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Top">
					<!-- Tutorial Button -->
					<Button Classes="theme-toggle"
							Command="{Binding OpenTutorialCommand}"
							Width="45"
							Height="45"
							ToolTip.Tip="Veiledning"
							Cursor="Hand">
						<materialIcons:MaterialIcon Kind="Book" 
													Width="24" 
													Height="24"
													Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"/>
					</Button>

					<!-- Refresh Button -->
					<Button Classes="theme-toggle"
							Command="{Binding RefreshDataCommand}"
							Width="45"
							Height="45"
							ToolTip.Tip="Oppdater data"
							Cursor="Hand">
						<materialIcons:MaterialIcon Kind="Refresh" 
													Width="24" 
													Height="24"
													Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"/>
					</Button>

					<!-- Settings Button -->
					<Button Classes="theme-toggle"
							Command="{Binding OpenSettingsCommand}"
							Width="45"
							Height="45"
							ToolTip.Tip="Innstillinger"
							Cursor="Hand">
						<materialIcons:MaterialIcon Kind="Settings" 
													Width="24" 
													Height="24"
													Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"/>
					</Button>

					<!-- Theme Toggle Button -->
					<Button Classes="theme-toggle"
							Content="{Binding Source={x:Static services:ThemeManager.Instance}, Path=ThemeIcon}"
							Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=ThemeIconColor}"
							Command="{Binding ToggleThemeCommand}"
							Width="45"
							Height="45"
							FontSize="22"
							ToolTip.Tip="Toggle dark/light mode"
							Cursor="Hand"/>
				</StackPanel>
			</Grid>

			<!-- Main Content Area -->
			<Grid Grid.Row="1" Margin="0,0,0,15">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="3*" MinWidth="350"/>
					<ColumnDefinition Width="5*" MinWidth="480"/>
				</Grid.ColumnDefinitions>

				<!-- Left Panel - Automation Controls -->
				<Border Grid.Column="0" Classes="dashboard-card" Margin="0,0,15,0" VerticalAlignment="Stretch">
					<StackPanel Spacing="18" VerticalAlignment="Center">
						<TextBlock Text="Automatisering" Classes="section-title"/>

						<Button Content="â–¶ Start automatisering"
								Classes="start-button"
								Command="{Binding StartAutomationCommand}"
								IsEnabled="{Binding !IsAutomationRunning}"
								HorizontalAlignment="Stretch"
								Height="42"/>

						<Button Content="â–  Stopp automatisering"
								Classes="stop-button"
								Command="{Binding StopAutomationCommand}"
								IsEnabled="{Binding IsAutomationRunning}"
								HorizontalAlignment="Stretch"
								Height="42"/>

						<!-- Retry Authentication Button (only visible when not authenticated) -->
						<Button Content="ðŸ”„ PrÃ¸v autentisering igjen"
								Classes="start-button"
								Command="{Binding RetryAuthenticationCommand}"
								IsVisible="{Binding !IsAuthenticated}"
								HorizontalAlignment="Stretch"
								Height="42"/>

						<!-- Status Box -->
						<Border Background="{Binding Source={x:Static services:ThemeManager.Instance}, Path=CardBackground}"
								CornerRadius="8"
								Padding="18,14"
								BorderThickness="1"
								BorderBrush="{Binding Source={x:Static services:ThemeManager.Instance}, Path=CardBorder}"
								Margin="0,10,0,0">
							<StackPanel Spacing="8">
								<TextBlock Text="Gjeldende status:"
										Classes="status-label"/>
								<TextBlock Text="{Binding StatusMessage}"
										Classes="status"
										HorizontalAlignment="Center"
										TextWrapping="Wrap"/>
							</StackPanel>
						</Border>
					</StackPanel>
				</Border>

				<!-- Right Panel - Statistics Cards -->
				<Grid Grid.Column="1" VerticalAlignment="Stretch">
					<Grid.RowDefinitions>
						<RowDefinition Height="*"/>
						<RowDefinition Height="15"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>
					<!-- Top Row Stats -->
					<Grid Grid.Row="0">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="15"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<!-- Today Card - DYNAMIC -->
						<Border Grid.Column="0" Classes="dashboard-card">
							<StackPanel VerticalAlignment="Center">
								<Grid>
									<TextBlock Text="I DAG" Classes="card-label"/>
									<TextBlock Text="ðŸ“…" FontSize="20" HorizontalAlignment="Right"/>
								</Grid>
								<TextBlock Text="{Binding Dashboard.TodayDisplay}" Classes="card-value green"/>
								<TextBlock Text="{Binding Dashboard.TodayStatus}" Classes="card-subtext"/>
							</StackPanel>
						</Border>

						<!-- Next Class Card - DYNAMIC -->
						<Border Grid.Column="2" Classes="dashboard-card">
							<StackPanel VerticalAlignment="Center">
								<Grid>
									<TextBlock Text="NESTE TIME" Classes="card-label"/>
									<TextBlock Text="â°" FontSize="20" HorizontalAlignment="Right"/>
								</Grid>
								<TextBlock Text="{Binding Dashboard.NextClassName}"
										FontSize="{Binding Dashboard.NextClassName, Converter={StaticResource TextLengthToFontSizeConverter}}"
										FontWeight="Bold"
										Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"
										TextWrapping="Wrap"
										MaxLines="2"/>
								<TextBlock Text="{Binding Dashboard.NextClassTime}"
										FontSize="16"
										Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextSecondary}"
										Margin="0,4,0,0"/>
								<TextBlock Text="{Binding Dashboard.NextClassRoom}"
										FontSize="13"
										Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextSecondary}"
										Margin="0,2,0,0"
										IsVisible="{Binding Dashboard.NextClassRoom, Converter={x:Static ObjectConverters.IsNotNull}}"/>
							</StackPanel>
						</Border>
					</Grid>

					<!-- Bottom Row Stats -->
					<Grid Grid.Row="2">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="15"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<!-- This Month Card - DYNAMIC -->
						<Border Grid.Column="0" Classes="dashboard-card">
							<StackPanel VerticalAlignment="Center">
								<Grid>
									<TextBlock Text="DENNE MÃ…NEDEN" Classes="card-label"/>
									<TextBlock Text="ðŸ“" FontSize="20" HorizontalAlignment="Right"/>
								</Grid>
								<TextBlock Text="{Binding Dashboard.MonthlyDisplay}" Classes="card-value orange"/>
								<TextBlock Text="{Binding Dashboard.MonthlyStatus}" Classes="card-subtext"/>
							</StackPanel>
						</Border>

						<!-- Over/Undertid Card - DYNAMIC -->
						<Border Grid.Column="2" Classes="dashboard-card">
							<StackPanel VerticalAlignment="Center">
								<Grid>
									<TextBlock Text="OVER-/UNDERTID" Classes="card-label"/>
									<TextBlock Text="âš " 
											FontSize="20" 
											HorizontalAlignment="Right" 
											VerticalAlignment="Top"
											Foreground="#FF9800"/>
								</Grid>
								<TextBlock Text="{Binding Dashboard.OvertimeValue}" 
										Classes="card-value"
										Foreground="{Binding Dashboard.OvertimeColor, Converter={StaticResource ColorNameToBrushConverter}}"/>
								<TextBlock Text="{Binding Dashboard.OvertimeStatus}" Classes="card-subtext"/>
							</StackPanel>
						</Border>
					</Grid>
				</Grid>
			</Grid>

			<!-- Weekly Progress Bar - FULL WIDTH AT THE BOTTOM -->
			<Border Grid.Row="2" Classes="dashboard-card">
				<StackPanel Spacing="12">
					<Grid>
						<TextBlock Text="Ukens fremmÃ¸te (STU)" Classes="section-title"/>
						<TextBlock Text="{Binding Dashboard.WeeklyPercentage}"
								FontSize="24"
								FontWeight="Bold"
								Foreground="#4CAF50"
								HorizontalAlignment="Right"
								VerticalAlignment="Center"/>
					</Grid>

					<TextBlock Text="{Binding Dashboard.WeeklyDisplay}"
							FontSize="12"
							Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextSecondary}"/>

					<!-- Progress Bar -->
					<Border Height="8" 
							Background="{Binding Source={x:Static services:ThemeManager.Instance}, Path=CardBorder}" 
							CornerRadius="4">
						<Border HorizontalAlignment="Left"
								Background="#4CAF50"
								CornerRadius="4">
							<Border.Width>
								<MultiBinding Converter="{StaticResource PercentageToWidthConverter}">
									<Binding Path="Dashboard.WeeklyPercentage"/>
									<Binding RelativeSource="{RelativeSource AncestorType=Border}" Path="Bounds.Width"/>
								</MultiBinding>
							</Border.Width>
						</Border>
					</Border>

					<!-- Weekly Grid Visualization - 5 Days (Mon-Fri) -->
					<ItemsControl ItemsSource="{Binding Dashboard.WeeklyDays}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<UniformGrid Rows="1" Columns="5"/>
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>
						<ItemsControl.ItemTemplate>
							<DataTemplate DataType="services:DailyAttendance">
								<Border Height="60" Margin="2" CornerRadius="6" ClipToBounds="True"
										Background="{Binding Source={x:Static services:ThemeManager.Instance}, Path=CardBorder}">
									<Grid>
										<!-- Filled portion based on percentage -->
										<Border VerticalAlignment="Bottom"
												Background="#4CAF50"
												CornerRadius="0,0,6,6">
											<Border.Height>
												<MultiBinding Converter="{StaticResource PercentageToHeightConverter}">
													<Binding Path="FillPercentage"/>
													<Binding RelativeSource="{RelativeSource AncestorType=Border}" Path="Bounds.Height"/>
												</MultiBinding>
											</Border.Height>
										</Border>
										
										<!-- Day label overlay -->
										<TextBlock Text="{Binding DayOfWeek, Converter={StaticResource DayOfWeekConverter}}"
												FontSize="10"
												FontWeight="SemiBold"
												Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"
												HorizontalAlignment="Center"
												VerticalAlignment="Top"
												Margin="0,4,0,0"/>
										
										<!-- Session count overlay -->
										<TextBlock HorizontalAlignment="Center"
												VerticalAlignment="Bottom"
												Margin="0,0,0,4"
												FontSize="9"
												Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}">
											<TextBlock.Text>
												<MultiBinding StringFormat="{}{0}/{1}">
													<Binding Path="RegisteredSessions"/>
													<Binding Path="TotalSessions"/>
												</MultiBinding>
											</TextBlock.Text>
										</TextBlock>
									</Grid>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>

					<TextBlock Text="{Binding Dashboard.WeeklyRemaining}"
							FontSize="11"
							Margin="0,4,0,0"
							Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextSecondary}"
							HorizontalAlignment="Right"/>
				</StackPanel>
			</Border>
		</Grid>
		</Grid>
		
		<!-- Tutorial Content (shown when ShowTutorial is true) -->
		<Grid Margin="0" IsVisible="{Binding ShowTutorial}">
			<views:TutorialView DataContext="{Binding}"/>
		</Grid>

		<!-- Feide Content (shown when ShowFeide is true) -->
		<Grid Margin="0" IsVisible="{Binding ShowFeide}">
			<views:FeideView DataContext="{Binding FeideViewModel}"/>
		</Grid>

		<Grid Margin="0" IsVisible="{Binding ShowSettings}">
        <views:SettingsWindow DataContext="{Binding SettingsViewModel}"/>
		</Grid>

		<ContentControl Name="OverlayContainer" 
                        Grid.RowSpan="999"
                        Grid.ColumnSpan="999"
                        IsVisible="False"
                        ZIndex="1000"/>

		<!-- Loading Overlay (shown during authentication) -->

		<Border Classes="loading-overlay" 
        Grid.RowSpan="999"
        Grid.ColumnSpan="999"
        ZIndex="9998">

    <!-- Only show when loading AND on dashboard (Only visible on MainWindow) -->

     <Border.IsVisible>
        <MultiBinding Converter="{x:Static BoolConverters.And}">
            <Binding Path="IsLoading"/>
            <Binding Path="ShowDashboard"/>
        </MultiBinding>
    </Border.IsVisible>
    <Grid>
        <Border Classes="loading-container"
                Width="300"
                Height="200"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
            <StackPanel Spacing="24" HorizontalAlignment="Center">

                <Grid Width="60" Height="60">

                    <!-- 8 dots in a circle that spin -->

                    <Ellipse Width="8" Height="8" Fill="#5B9BFF" 
                             HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,0,0,0">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="Infinite">
                                        <KeyFrame Cue="0%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="12.5%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="100%"><Setter Property="Opacity" Value="0.15"/></KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                    
                    <Ellipse Width="8" Height="8" Fill="#5B9BFF" 
                             HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,8,8,0">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="Infinite" Delay="0:0:0.125">
                                        <KeyFrame Cue="0%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="12.5%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="100%"><Setter Property="Opacity" Value="0.15"/></KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                    
                    <Ellipse Width="8" Height="8" Fill="#5B9BFF" 
                             HorizontalAlignment="Right" VerticalAlignment="Center">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="Infinite" Delay="0:0:0.25">
                                        <KeyFrame Cue="0%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="12.5%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="100%"><Setter Property="Opacity" Value="0.15"/></KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                    
                    <Ellipse Width="8" Height="8" Fill="#5B9BFF" 
                             HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,8,8">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="Infinite" Delay="0:0:0.375">
                                        <KeyFrame Cue="0%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="12.5%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="100%"><Setter Property="Opacity" Value="0.15"/></KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                    
                    <Ellipse Width="8" Height="8" Fill="#5B9BFF" 
                             HorizontalAlignment="Center" VerticalAlignment="Bottom">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="Infinite" Delay="0:0:0.5">
                                        <KeyFrame Cue="0%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="12.5%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="100%"><Setter Property="Opacity" Value="0.15"/></KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                    
                    <Ellipse Width="8" Height="8" Fill="#5B9BFF" 
                             HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="8,0,0,8">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="Infinite" Delay="0:0:0.625">
                                        <KeyFrame Cue="0%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="12.5%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="100%"><Setter Property="Opacity" Value="0.15"/></KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                    
                    <Ellipse Width="8" Height="8" Fill="#5B9BFF" 
                             HorizontalAlignment="Left" VerticalAlignment="Center">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="Infinite" Delay="0:0:0.75">
                                        <KeyFrame Cue="0%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="12.5%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="100%"><Setter Property="Opacity" Value="0.15"/></KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                    
                    <Ellipse Width="8" Height="8" Fill="#5B9BFF" 
                             HorizontalAlignment="Left" VerticalAlignment="Top" Margin="8,8,0,0">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="Infinite" Delay="0:0:0.875">
                                        <KeyFrame Cue="0%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="12.5%"><Setter Property="Opacity" Value="1"/></KeyFrame>
                                        <KeyFrame Cue="100%"><Setter Property="Opacity" Value="0.15"/></KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                </Grid>

                <!-- Loading Text -->

                <StackPanel Spacing="8" HorizontalAlignment="Center">
                    <TextBlock Text="Autentiserer..."
                              FontSize="18"
                              FontWeight="SemiBold"
                              Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextPrimary}"
                              HorizontalAlignment="Center"/>
                    <TextBlock Text="Logger inn pÃ¥ iskole"
                              FontSize="13"
                              Foreground="{Binding Source={x:Static services:ThemeManager.Instance}, Path=TextSecondary}"
                              HorizontalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</Border>
	</Grid>
	
</Window>