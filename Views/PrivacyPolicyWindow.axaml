<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AkademiTrack.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="650"
        x:Class="AkademiTrack.Views.PrivacyPolicyWindow"
        x:DataType="vm:PrivacyPolicyWindowViewModel"
        Icon="/Assets/AT-Transparrent.png"
        Title="PersonvernserklÃ¦ring - AkademiTrack"
        Background="#F8F9FA"
        Height="700"
        Width="500"
        MinWidth="500"
        MinHeight="600"
        MaxHeight="750"
        WindowStartupLocation="CenterScreen"
        CanResize="true">

	<Window.Styles>
		<!-- Force all buttons to always be visible -->
		<Style Selector="Button">
			<Setter Property="IsVisible" Value="True"/>
			<Setter Property="Focusable" Value="True"/>
		</Style>

		<Style Selector="Button:disabled">
			<Setter Property="IsVisible" Value="True"/>
		</Style>

		<!-- Remove focus outlines globally -->
		<Style Selector="Button:focus /template/ Border">
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
		</Style>

		<Style Selector="Button:focus-visible /template/ Border">
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
		</Style>

		<!-- Primary Button Style -->
		<Style Selector="Button.primary">
			<Setter Property="Background" Value="#007ACC"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="CornerRadius" Value="6"/>
			<Setter Property="Padding" Value="24,14"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="FontSize" Value="15"/>
			<Setter Property="MinWidth" Value="160"/>
			<Setter Property="IsVisible" Value="True"/>
			<Setter Property="Template">
				<ControlTemplate>
					<Border Name="PART_Border"
							Background="{TemplateBinding Background}"
							CornerRadius="{TemplateBinding CornerRadius}"
							Padding="{TemplateBinding Padding}"
							BorderThickness="0"
							BorderBrush="Transparent">
						<ContentPresenter Name="PART_ContentPresenter"
										Content="{TemplateBinding Content}"
										HorizontalAlignment="Center"
										VerticalAlignment="Center"
										TextBlock.Foreground="{TemplateBinding Foreground}"
										TextBlock.FontWeight="{TemplateBinding FontWeight}"
										TextBlock.FontSize="{TemplateBinding FontSize}"
										TextBlock.TextAlignment="Center"/>
					</Border>
				</ControlTemplate>
			</Setter>
		</Style>

		<Style Selector="Button.primary:pointerover /template/ Border#PART_Border">
			<Setter Property="Background" Value="#005A9E"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.primary:focus /template/ Border#PART_Border">
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.primary:disabled /template/ Border#PART_Border">
			<Setter Property="Background" Value="#CCCCCC"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.primary:disabled /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="TextBlock.Foreground" Value="#888888"/>
		</Style>

		<!-- Secondary Button Style -->
		<Style Selector="Button.secondary">
			<Setter Property="Background" Value="#6C757D"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="Medium"/>
			<Setter Property="CornerRadius" Value="6"/>
			<Setter Property="Padding" Value="18,12"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="IsVisible" Value="True"/>
			<Setter Property="Template">
				<ControlTemplate>
					<Border Name="PART_Border"
							Background="{TemplateBinding Background}"
							CornerRadius="{TemplateBinding CornerRadius}"
							Padding="{TemplateBinding Padding}"
							BorderThickness="0"
							BorderBrush="Transparent">
						<ContentPresenter Name="PART_ContentPresenter"
										Content="{TemplateBinding Content}"
										HorizontalAlignment="Center"
										VerticalAlignment="Center"
										TextBlock.Foreground="{TemplateBinding Foreground}"
										TextBlock.FontWeight="{TemplateBinding FontWeight}"
										TextBlock.FontSize="{TemplateBinding FontSize}"
										TextBlock.TextAlignment="Center"/>
					</Border>
				</ControlTemplate>
			</Setter>
		</Style>

		<Style Selector="Button.secondary:pointerover /template/ Border#PART_Border">
			<Setter Property="Background" Value="#545B62"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<Style Selector="Button.secondary:focus /template/ Border#PART_Border">
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
		</Style>

		<!-- CheckBox Styles with Full Template -->
		<Style Selector="CheckBox">
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="Foreground" Value="#212529"/>
			<Setter Property="MinHeight" Value="32"/>
			<Setter Property="Template">
				<ControlTemplate>
					<Grid ColumnDefinitions="Auto,*">
						<Border Name="PART_Border"
								Grid.Column="0"
								Width="24"
								Height="24"
								Background="White"
								BorderBrush="#CED4DA"
								BorderThickness="2"
								CornerRadius="4"
								VerticalAlignment="Center"
								Margin="0,0,10,0">
							<Viewbox Width="16" Height="16">
								<Path Name="PART_Check"
									  IsVisible="False"
									  Stroke="#007ACC"
									  StrokeThickness="2"
									  Data="M 2,8 L 8,14 L 18,4"
									  Stretch="Uniform"/>
							</Viewbox>
						</Border>
						<ContentPresenter Grid.Column="1"
										  Content="{TemplateBinding Content}"
										  VerticalAlignment="Center"/>
					</Grid>
				</ControlTemplate>
			</Setter>
		</Style>

		<Style Selector="CheckBox:pointerover /template/ Border#PART_Border">
			<Setter Property="BorderBrush" Value="#007ACC"/>
		</Style>

		<Style Selector="CheckBox:checked /template/ Border#PART_Border">
			<Setter Property="Background" Value="#007ACC"/>
			<Setter Property="BorderBrush" Value="#007ACC"/>
		</Style>

		<Style Selector="CheckBox:checked /template/ Path#PART_Check">
			<Setter Property="IsVisible" Value="True"/>
			<Setter Property="Stroke" Value="White"/>
		</Style>

		<!-- Text Styles -->
		<Style Selector="TextBlock.content">
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="Foreground" Value="#495057"/>
			<Setter Property="TextWrapping" Value="Wrap"/>
			<Setter Property="LineHeight" Value="20"/>
		</Style>

		<Style Selector="TextBlock.link">
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="Foreground" Value="#007ACC"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="TextDecorations" Value="Underline"/>
		</Style>
	</Window.Styles>

	<Grid RowDefinitions="Auto,*,Auto" Margin="0" MaxHeight="750">
		<!-- Header -->
		<Border Grid.Row="0" Background="#007ACC" Padding="30,16">
			<StackPanel Spacing="3">
				<TextBlock Text="PersonvernserklÃ¦ring"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="White"/>
				<TextBlock Text="Vennligst les og godta personvernserklÃ¦ringen for Ã¥ fortsette"
                           FontSize="11"
                           Foreground="#E8F4FC"/>
			</StackPanel>
		</Border>

		<!-- Content -->
		<ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Visible"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="20,15,20,15">
			<StackPanel Spacing="16">

				<!-- NEW: Upgrade Changelog Box (only visible for existing users) -->
				<Border Background="#FFF4E5"
                        BorderBrush="#FF9800"
                        BorderThickness="2"
                        CornerRadius="8"
                        Padding="16"
                        IsVisible="{Binding IsUpgrade}">
					<StackPanel Spacing="10">
						<StackPanel Orientation="Horizontal" Spacing="8">
							<TextBlock Text="ðŸ””"
                                       FontSize="18"
                                       VerticalAlignment="Center"/>
							<TextBlock Text="Oppdatert personvernserklÃ¦ring"
                                       FontWeight="Bold"
                                       FontSize="15"
                                       Foreground="#E65100"
                                       VerticalAlignment="Center"/>
						</StackPanel>

						<TextBlock TextWrapping="Wrap"
                                   FontSize="12"
                                   Foreground="#BF360C"
                                   LineHeight="18">
							<Run Text="Vi har oppdatert vÃ¥r personvernserklÃ¦ring fra versjon "/>
							<Run Text="{Binding UserCurrentVersion, FallbackValue='1.0'}" FontWeight="Bold"/>
							<Run Text=" til versjon "/>
							<Run Text="{Binding LatestVersion, FallbackValue='1.1'}" FontWeight="Bold"/>
							<Run Text=". Vennligst les endringene nedenfor og godta den nye versjonen."/>
						</TextBlock>

						<Separator Background="#FFB74D" Height="1" Margin="0,4"/>

						<TextBlock TextWrapping="Wrap"
                                   FontSize="13"
                                   Foreground="#E65100">
							<Run Text="Hva er nytt i versjon "/>
							<Run Text="{Binding LatestVersion, FallbackValue='1.1'}" FontWeight="SemiBold"/>
							<Run Text=":"/>
						</TextBlock>

						<!-- Changelog bullet points -->
						<ItemsControl ItemsSource="{Binding ChangelogItems, FallbackValue={x:Null}}">
							<ItemsControl.ItemTemplate>
								<DataTemplate x:DataType="x:String">
									<StackPanel Orientation="Horizontal" Spacing="8" Margin="0,3">
										<TextBlock Text="âœ“"
                                                   FontSize="12"
                                                   Foreground="#43A047"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Top"
                                                   Margin="0,1,0,0"/>
										<TextBlock Text="{Binding}"
                                                   TextWrapping="Wrap"
                                                   FontSize="12"
                                                   Foreground="#4E342E"
                                                   LineHeight="18"/>
									</StackPanel>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</StackPanel>
				</Border>

				<!-- Info Box -->
				<Border Background="#E7F3FF"
                        BorderBrush="#007ACC"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="16"
						Margin="-10,0,0,0">
					<StackPanel Spacing="8">
						<TextBlock Text="ðŸ“‹ Viktig informasjon"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   Foreground="#004C7F"/>
						<TextBlock TextWrapping="Wrap"
                                   FontSize="13"
                                   Foreground="#004C7F"
                                   LineHeight="20">
							Du mÃ¥ godta personvernserklÃ¦ringen for Ã¥ bruke AkademiTrack. For full informasjon om hvordan vi behandler dine data, besÃ¸k vÃ¥r nettside.
						</TextBlock>
					</StackPanel>
				</Border>

				<!-- Link to full policy -->
				<StackPanel Spacing="6">
					<TextBlock Text="Les vÃ¥r fullstendige personvernserklÃ¦ring:"
                               Classes="content"
                               FontWeight="Medium"
                               FontSize="13"/>
					<TextBlock Text="https://cybergutta.github.io/AkademietTrack/privacy-policy.html"
                               Classes="link"
                               FontSize="12"
                               Tapped="OnPrivacyPolicyLinkTapped"/>
				</StackPanel>

				<!-- Summary -->
				<StackPanel Spacing="6">
					<TextBlock Text="Sammendrag av databehandling:"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="#212529"/>

					<TextBlock Classes="content" FontSize="13" LineHeight="20">
						â€¢ Vi lagrer dine Feide-innloggingsopplysninger kryptert lokalt pÃ¥ din enhet
					</TextBlock>
					<TextBlock Classes="content" FontSize="13" LineHeight="20">
						â€¢ Vi bruker disse opplysningene kun for automatisk fremmÃ¸teregistrering
					</TextBlock>
					<TextBlock Classes="content" FontSize="13" LineHeight="20">
						â€¢ Din aktiveringsnÃ¸kkel og e-post lagres i vÃ¥r database
					</TextBlock>
					<TextBlock Classes="content" FontSize="13" LineHeight="20">
						â€¢ Vi deler ikke dine personopplysninger med tredjeparter
					</TextBlock>
					<TextBlock Classes="content" FontSize="13" LineHeight="20">
						â€¢ Du kan nÃ¥r som helst slette dine data ved Ã¥ kontakte oss
					</TextBlock>
				</StackPanel>

				<!-- Consent Checkbox -->
				<Border Background="#F8F9FA"
						BorderBrush="#007ACC"
						BorderThickness="2"
						CornerRadius="6"
						Padding="14"
						Margin="-10,8,0,55">
					<CheckBox IsChecked="{Binding HasAccepted}">
						<TextBlock TextWrapping="Wrap"
								   FontSize="13"
								   Foreground="#212529"
								   FontWeight="Medium"
								   LineHeight="20">
							<Run Text="Jeg har lest og godtar"/>
							<Run Text="personvernserklÃ¦ringen" FontWeight="Bold"/>
							<Run Text="for AkademiTrack"/>
						</TextBlock>
					</CheckBox>
				</Border>

				<!-- Error Message -->
				<TextBlock Text="{Binding ErrorMessage}"
                           Foreground="#DC3545"
                           FontSize="12"
                           IsVisible="{Binding HasError}"
                           TextWrapping="Wrap"
                           Margin="0,0,0,10"/>

			</StackPanel>
		</ScrollViewer>

		<!-- Footer (ALWAYS VISIBLE) -->
		<Border Grid.Row="2"
                Background="White"
                BorderBrush="#DEE2E6"
                BorderThickness="0,2,0,0"
                Padding="20,18"
                BoxShadow="0 -2 8 0 #10000000">
			<Grid ColumnDefinitions="*,Auto">

				<!-- Exit Button -->
				<Button Grid.Column="0"
                        Content="Avslutt"
                        Command="{Binding ExitCommand}"
                        Classes="secondary"
                        HorizontalAlignment="Left"/>

				<!-- Accept Button -->
				<Button Grid.Column="1"
                        Content="{Binding AcceptButtonText}"
                        Command="{Binding AcceptCommand}"
                        IsEnabled="{Binding CanAccept}"
                        Classes="primary"/>
			</Grid>
		</Border>
	</Grid>
</Window>